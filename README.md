# ğŸš€ Strapi on AWS ECS with CI/CD

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CI/CD PIPELINE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚   DEVELOPER  â”‚      â”‚    GITHUB    â”‚      â”‚   GITHUB     â”‚                 â”‚
â”‚   â”‚              â”‚ push â”‚              â”‚ trigger â”‚  ACTIONS   â”‚                 â”‚
â”‚   â”‚   git push   â”‚â”€â”€â”€â”€â”€â–ºâ”‚    REPO      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚                 â”‚
â”‚   â”‚              â”‚      â”‚   (main)     â”‚         â”‚ Workflows  â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                        â”‚                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                         â”‚                              â”‚                    â”‚   â”‚
â”‚                         â–¼                              â–¼                    â”‚   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚              â”‚   deploy.yml     â”‚          â”‚  terraform.yml   â”‚             â”‚   â”‚
â”‚              â”‚                  â”‚          â”‚                  â”‚             â”‚   â”‚
â”‚              â”‚ â€¢ Build Docker   â”‚          â”‚ â€¢ terraform init â”‚             â”‚   â”‚
â”‚              â”‚ â€¢ Push to ECR    â”‚          â”‚ â€¢ terraform plan â”‚             â”‚   â”‚
â”‚              â”‚ â€¢ Update ECS     â”‚          â”‚ â€¢ terraform applyâ”‚             â”‚   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚                       â”‚                             â”‚                       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚                             â”‚                           â”‚
                        â–¼                             â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             AWS CLOUD                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚    Amazon S3    â”‚   â”‚   Amazon ECR    â”‚   â”‚   DynamoDB      â”‚               â”‚
â”‚  â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚               â”‚
â”‚  â”‚  Terraform      â”‚   â”‚  Docker Images  â”‚   â”‚  State Locks    â”‚               â”‚
â”‚  â”‚  State Backend  â”‚   â”‚  strapi:sha     â”‚   â”‚                 â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                 â”‚                                               â”‚
â”‚                                 â”‚ Pull Image                                    â”‚
â”‚                                 â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          VPC (10.0.0.0/16)                                â”‚ â”‚
â”‚  â”‚                                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚  â”‚   Subnet A (10.0.1.0)   â”‚     â”‚   Subnet B (10.0.2.0)   â”‚             â”‚ â”‚
â”‚  â”‚  â”‚      ap-south-1a        â”‚     â”‚      ap-south-1b        â”‚             â”‚ â”‚
â”‚  â”‚  â”‚                         â”‚     â”‚                         â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   ECS Fargate     â”‚  â”‚     â”‚  â”‚   ECS Fargate     â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                   â”‚  â”‚     â”‚  â”‚   (standby)       â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚     â”‚  â”‚                   â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚   Strapi    â”‚  â”‚  â”‚     â”‚  â”‚                   â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Container  â”‚  â”‚  â”‚     â”‚  â”‚                   â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Port:1337  â”‚  â”‚  â”‚     â”‚  â”‚                   â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚                         â”‚             â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚               â”‚                                                           â”‚ â”‚
â”‚  â”‚               â”‚ Port 5432 (SSL)                                          â”‚ â”‚
â”‚  â”‚               â–¼                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚                    RDS PostgreSQL                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                    (db.t3.micro)                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                                   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   Database: strapidb | Storage: 20GB | SSL: Enabled              â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  CloudWatch     â”‚   â”‚  IAM Roles      â”‚   â”‚ Security Groups â”‚               â”‚
â”‚  â”‚  Logs           â”‚   â”‚                 â”‚   â”‚                 â”‚               â”‚
â”‚  â”‚  /ecs/strapi    â”‚   â”‚ â€¢ Execution     â”‚   â”‚ â€¢ ECS: 1337     â”‚               â”‚
â”‚  â”‚                 â”‚   â”‚ â€¢ Task          â”‚   â”‚ â€¢ RDS: 5432     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Project Structure

```
strapi/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ deploy.yml        # App deployment (build â†’ ECR â†’ ECS)
â”‚       â””â”€â”€ terraform.yml     # Infrastructure deployment
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ backend.tf            # S3 state backend
â”‚   â”œâ”€â”€ ecr.tf                # ECR repository
â”‚   â”œâ”€â”€ ecs.tf                # ECS cluster, service, task
â”‚   â”œâ”€â”€ rds.tf                # PostgreSQL database
â”‚   â”œâ”€â”€ iam.tf                # IAM roles
â”‚   â”œâ”€â”€ security-groups.tf    # Network security
â”‚   â”œâ”€â”€ variable.tf           # Variables
â”‚   â””â”€â”€ output.tf             # Outputs
â”œâ”€â”€ config/                   # Strapi configuration
â”œâ”€â”€ src/                      # Strapi source code
â”œâ”€â”€ dockerfile                # Docker build
â””â”€â”€ docker-compose.yml        # Local development
```

## ğŸ”„ CI/CD Workflows

### App Deployment (`deploy.yml`)
Triggers on: Push to `main` (excluding `terraform/` and `*.md`)

```
git push â†’ Build Docker â†’ Push to ECR â†’ Update ECS Task â†’ Deploy
```

### Infrastructure (`terraform.yml`)
Triggers on: Push to `main` with changes in `terraform/`

```
git push â†’ terraform init â†’ terraform plan â†’ terraform apply
```

## ğŸ” GitHub Secrets Required

| Secret | Description |
|--------|-------------|
| `AWS_ACCESS_KEY_ID` | AWS access key |
| `AWS_SECRET_ACCESS_KEY` | AWS secret key |
| `TF_VAR_DB_PASSWORD` | RDS password |
| `TF_VAR_APP_KEYS` | Strapi app keys |
| `TF_VAR_JWT_SECRET` | JWT secret |
| `TF_VAR_ADMIN_JWT_SECRET` | Admin JWT secret |
| `TF_VAR_API_TOKEN_SALT` | API token salt |
| `TF_VAR_TRANSFER_TOKEN_SALT` | Transfer token salt |

## ğŸš€ Quick Start

### 1. Initial Setup (one-time)
```bash
cd terraform
cp terraform.tfvars.example terraform.tfvars
# Edit terraform.tfvars with your values
terraform init
terraform apply
```

### 2. Deploy App
```bash
git add .
git commit -m "Your changes"
git push origin main
# GitHub Actions handles the rest!
```

### 3. Local Development
```bash
docker-compose up -d
# Access at http://localhost:1337/admin
```

## ğŸ“Š Infrastructure Components

| Component | Type | Purpose |
|-----------|------|---------|
| **ECR** | Container Registry | Store Docker images |
| **ECS Fargate** | Serverless Compute | Run Strapi containers |
| **RDS PostgreSQL** | Managed Database | Data persistence |
| **S3** | Object Storage | Terraform state |
| **DynamoDB** | NoSQL Database | State locking |
| **CloudWatch** | Monitoring | Logs & metrics |
| **IAM** | Security | Access control |

## âœ… Features

- ğŸ”„ **Automated CI/CD** - Push to deploy
- ğŸ—ï¸ **Infrastructure as Code** - Terraform managed
- ğŸ”’ **Secure** - SSL, IAM roles, private DB
- ğŸ“ˆ **Scalable** - ECS Fargate auto-scaling
- ğŸ’¾ **State Management** - S3 backend with locking
- ğŸ“ **Logging** - CloudWatch integration

## ğŸŒ Access

After deployment:
- **Strapi Admin**: `http://<ECS_PUBLIC_IP>:1337/admin`
- **API**: `http://<ECS_PUBLIC_IP>:1337/api`

Get ECS task public IP:
```bash
aws ecs list-tasks --cluster strapi-cluster --region ap-south-1
aws ecs describe-tasks --cluster strapi-cluster --tasks <TASK_ARN> --region ap-south-1
```
